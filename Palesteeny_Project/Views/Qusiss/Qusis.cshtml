@model List<Palesteeny_Project.Models.Qusi>

@{
   
    var categories = ViewData["Categories"] as List<string> ?? new List<string>();
}

<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>قصص</title>
    <link rel="stylesheet" href="~/css/Qisas.css" />
</head>

<body>
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <h3 style="text-align: left;">
            <a asp-controller="Qusiss" asp-action="Favorite">
                <img src="~/images/MyLibraryLogo.png" alt="مكتبتي" />
            </a>
        </h3>

        <h2 class="h2decoration">
            <span class="arrow-text">
                <img src="~/images/Arrow.png" alt="سهم" />
                <a asp-controller="Qusiss" asp-action="Qusis" class="link-text">قصص</a>
            </span>
        </h2>
    </div>
    <br />

    <div>
        <ul class="categories">
         
            @foreach (var category in categories)
            {
                <li><a href="#" class="categoriescontent">@category</a></li>
            }
            <li><a href="#" class="categoriescontent">عرض الكل</a></li>
        </ul>
    </div>
    <br />

    <p style="text-align: right; font-size:x-large; font-weight: bolder;">:نقترح لك هذه المجموعة من القصص المسلية</p>
    <br />

    <div class="stories_container" style="display: grid;">
        <div class="stories">
          =
            @foreach (var story in Model)
            {
                <div class="story" data-category="@story.Category">
                    <div class="story-image">
                        <div class="image-container">
                            <div class="front">
                                <img src="~/images/@story.CoverImage" alt="@story.Title" />
                            </div>
                            <div class="back">
                                <img src="~/images/@story.CoverImage" alt="@story.Title" />
                                <a asp-controller="Qusiss" asp-action="Qusa" asp-route-id="@story.Id">اقرأها الآن !!</a>
                            </div>
                        </div>
                    </div>
                    <p>@story.Title</p>
                </div>
            }
        </div>
    </div>

    <br />
    <div style="display: flex; justify-content: space-between;">
        <button id="prev" class="nav-button">
            <img src="~/images/Left.png" alt="السابق" />
        </button>
        <button id="next" class="nav-button">
            <img src="~/images/Right.png" alt="التالي" />
        </button>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let currentPage = 0;
            const itemsPerPage = 4;

            const container = document.querySelector(".stories_container .stories");
            const prevBtn = document.getElementById("prev");
            const nextBtn = document.getElementById("next");

           
            const allStories = [...container.children];

            let currentMode = "all";
            let filteredStories = [];

            function showAllStoriesPage() {
                container.innerHTML = "";
                const start = currentPage * itemsPerPage;
                const end = start + itemsPerPage;
                const storiesToShow = allStories.slice(start, end);
                storiesToShow.forEach(story => container.appendChild(story));
                if (storiesToShow.length === 0 && currentPage > 0) {
                    currentPage = 0;
                    showAllStoriesPage();
                }
            }

            function showFilteredPage(filtered) {
                container.innerHTML = "";
                const start = currentPage * itemsPerPage;
                const end = start + itemsPerPage;
                const storiesToShow = filtered.slice(start, end);
                storiesToShow.forEach(story => container.appendChild(story));
                if (storiesToShow.length === 0 && currentPage > 0) {
                    currentPage = 0;
                    showFilteredPage(filtered);
                }
            }

            showAllStoriesPage();

            prevBtn.addEventListener("click", () => {
                if (currentMode === "all") {
                    const maxPage = Math.ceil(allStories.length / itemsPerPage) - 1;
                    currentPage = currentPage > 0 ? currentPage - 1 : maxPage;
                    showAllStoriesPage();
                } else {
                    const maxPage = Math.ceil(filteredStories.length / itemsPerPage) - 1;
                    currentPage = currentPage > 0 ? currentPage - 1 : maxPage;
                    showFilteredPage(filteredStories);
                }
            });

            nextBtn.addEventListener("click", () => {
                if (currentMode === "all") {
                    const maxPage = Math.ceil(allStories.length / itemsPerPage) - 1;
                    currentPage = currentPage < maxPage ? currentPage + 1 : 0;
                    showAllStoriesPage();
                } else {
                    const maxPage = Math.ceil(filteredStories.length / itemsPerPage) - 1;
                    currentPage = currentPage < maxPage ? currentPage + 1 : 0;
                    showFilteredPage(filteredStories);
                }
            });

            document.querySelectorAll(".categoriescontent").forEach(link => {
                link.addEventListener("click", e => {
                    e.preventDefault();
                    const category = e.target.textContent.trim();
                    currentPage = 0;

                    if (category === "عرض الكل") {
                        currentMode = "all";
                        showAllStoriesPage();
                        return;
                    }

                    currentMode = "filtered";
                    filteredStories = allStories.filter(story => story.getAttribute("data-category") === category);
                    showFilteredPage(filteredStories);
                });
            });
        });
    </script>

</body>

</html>
